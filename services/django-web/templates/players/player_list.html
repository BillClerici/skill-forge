{% extends 'base.html' %}

{% block title %}Players - SkillForge RPG{% endblock %}

{% block content %}
<div class="row">
    <div class="col s12">
        <h4 class="white-text" style="color: var(--rpg-gold) !important; text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);">
            <i class="material-icons left">person</i>Players
        </h4>
        <p class="grey-text" style="font-size: 1.1rem;">Manage all players across all accounts</p>
    </div>
</div>

<!-- Stats and Filters -->
<div class="row">
    <div class="col s12">
        <div class="card">
            <div class="card-content">
                <div class="row" style="margin-bottom: 0;">
                    <div class="col s12 m3 center-align">
                        <h5 style="color: var(--rpg-gold); margin: 0;">{{ total_players }}</h5>
                        <p class="grey-text">Total Players</p>
                    </div>
                    <div class="col s12 m3 center-align">
                        <h5 style="color: var(--rpg-silver); margin: 0;">{{ page_obj.paginator.count }}</h5>
                        <p class="grey-text">Showing</p>
                    </div>
                    <div class="col s12 m3 center-align">
                        {% if request.GET.account %}
                        <a href="{% url 'player_list' %}" class="btn-small waves-effect waves-light red" style="margin-top: 10px;">
                            <i class="material-icons left">clear</i>Clear Filter
                        </a>
                        {% else %}
                        <p class="grey-text" style="margin-top: 15px;">All Accounts</p>
                        {% endif %}
                    </div>
                    <div class="col s12 m3 center-align">
                        <a href="#create-modal" class="btn waves-effect waves-light modal-trigger" style="margin-top: 10px;">
                            <i class="material-icons left">add</i>Add Player
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Players Table -->
{% if players %}
<div class="row">
    <div class="col s12">
        <div class="card">
            <div class="card-content">
                <table class="highlight responsive-table">
                    <thead>
                        <tr>
                            <th>Display Name</th>
                            <th>Account</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Joined</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for player in players %}
                        <tr>
                            <td>
                                <div style="display: flex; align-items: center;">
                                    <i class="material-icons" style="margin-right: 10px; color: var(--rpg-gold);">person</i>
                                    <div>
                                        <a href="{% url 'player_detail' player.player_id %}" style="color: var(--rpg-gold); font-weight: 600; font-size: 1.05rem;">
                                            {{ player.display_name }}
                                        </a>
                                        {% if player.email %}
                                        <br>
                                        <small class="grey-text">{{ player.email }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                {% if player.account %}
                                <a href="{% url 'account_detail' player.account.account_id %}" style="color: var(--rpg-silver);">
                                    {{ player.account.name }}
                                </a>
                                {% else %}
                                <span class="grey-text">N/A</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="chip" style="margin: 0;">
                                    {{ player.role|default:"Player" }}
                                </span>
                            </td>
                            <td>
                                {% if player.is_active %}
                                <span style="color: var(--rpg-green);">
                                    <i class="material-icons tiny" style="vertical-align: middle;">check_circle</i> Active
                                </span>
                                {% else %}
                                <span class="grey-text">
                                    <i class="material-icons tiny" style="vertical-align: middle;">cancel</i> Inactive
                                </span>
                                {% endif %}
                            </td>
                            <td>
                                {{ player.created_at|date:"M d, Y" }}<br>
                                <small class="grey-text">{{ player.created_at|timesince }} ago</small>
                            </td>
                            <td>
                                <a href="{% url 'player_detail' player.player_id %}" class="btn-small waves-effect waves-light" style="margin-right: 5px; margin-bottom: 5px;">
                                    <i class="material-icons">visibility</i>
                                </a>
                                <a href="#" class="btn-small waves-effect waves-light blue" style="margin-bottom: 5px;">
                                    <i class="material-icons">edit</i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Pagination -->
{% if page_obj.has_other_pages %}
<div class="row">
    <div class="col s12 center-align">
        <ul class="pagination">
            {% if page_obj.has_previous %}
            <li class="waves-effect">
                <a href="?page=1{% if request.GET.account %}&account={{ request.GET.account }}{% endif %}" style="color: var(--rpg-gold);">
                    <i class="material-icons">first_page</i>
                </a>
            </li>
            <li class="waves-effect">
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.account %}&account={{ request.GET.account }}{% endif %}" style="color: var(--rpg-gold);">
                    <i class="material-icons">chevron_left</i>
                </a>
            </li>
            {% else %}
            <li class="disabled">
                <a href="#!"><i class="material-icons">first_page</i></a>
            </li>
            <li class="disabled">
                <a href="#!"><i class="material-icons">chevron_left</i></a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                <li class="active" style="background-color: var(--rpg-gold);">
                    <a href="#!" style="color: #1a1a2e;">{{ num }}</a>
                </li>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="waves-effect">
                    <a href="?page={{ num }}{% if request.GET.account %}&account={{ request.GET.account }}{% endif %}" style="color: var(--rpg-gold);">{{ num }}</a>
                </li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="waves-effect">
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.account %}&account={{ request.GET.account }}{% endif %}" style="color: var(--rpg-gold);">
                    <i class="material-icons">chevron_right</i>
                </a>
            </li>
            <li class="waves-effect">
                <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.account %}&account={{ request.GET.account }}{% endif %}" style="color: var(--rpg-gold);">
                    <i class="material-icons">last_page</i>
                </a>
            </li>
            {% else %}
            <li class="disabled">
                <a href="#!"><i class="material-icons">chevron_right</i></a>
            </li>
            <li class="disabled">
                <a href="#!"><i class="material-icons">last_page</i></a>
            </li>
            {% endif %}
        </ul>
    </div>
</div>
{% endif %}

{% else %}
<!-- Empty State -->
<div class="row">
    <div class="col s12">
        <div class="card">
            <div class="card-content center-align" style="padding: 60px 24px;">
                <i class="material-icons" style="font-size: 120px; color: var(--rpg-gold); opacity: 0.3;">person_outline</i>
                <h5 class="grey-text">No Players Found</h5>
                {% if request.GET.account %}
                <p class="grey-text">No players found for this account</p>
                <div style="margin-top: 30px;">
                    <a href="{% url 'player_list' %}" class="btn waves-effect waves-light red">
                        <i class="material-icons left">clear</i>Clear Filter
                    </a>
                </div>
                {% else %}
                <p class="grey-text">Start by adding your first player</p>
                <div style="margin-top: 30px;">
                    <a href="#create-modal" class="btn-large waves-effect waves-light modal-trigger">
                        <i class="material-icons left">add</i>Add First Player
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Create Modal (placeholder) -->
<div id="create-modal" class="modal" style="background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%); border: 2px solid var(--rpg-gold);">
    <div class="modal-content">
        <h4 style="color: var(--rpg-gold);">
            <i class="material-icons left">person_add</i>Add New Player
        </h4>
        <p class="grey-text">Player creation form will be implemented here</p>
    </div>
    <div class="modal-footer" style="background-color: transparent;">
        <a href="#!" class="modal-close waves-effect waves-light btn-flat" style="color: var(--rpg-gold);">Close</a>
        <a href="#!" class="waves-effect waves-light btn">Add Player</a>
    </div>
</div>
{% endblock %}
