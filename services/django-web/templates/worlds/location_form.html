{% extends "base.html" %}

{% block title %}{% if location %}Edit Location{% else %}Create Location{% endif %} - SkillForge RPG{% endblock %}

{% block extra_css %}
<style>
    /* Input field labels and text */
    .input-field label {
        color: var(--rpg-gold) !important;
    }

    .input-field label.active {
        color: var(--rpg-gold) !important;
    }

    /* Helper text color */
    .helper-text {
        color: #b8b8d1 !important;
    }

    /* Add spacing between input fields */
    .input-field {
        margin-bottom: 40px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col s12">
        <h3 style="color: var(--rpg-gold); text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);">
            <i class="material-icons left" style="font-size: 2.5rem;">location_on</i>
            {% if location %}Edit Location{% else %}Create New Location{% endif %}
        </h3>
    </div>
</div>

<div class="row">
    <div class="col s12">
        <div class="card">
            <div class="card-content">
                <form method="post" id="location-form">
                    {% csrf_token %}

                    <!-- Location Name -->
                    <div class="input-field">
                        <i class="material-icons prefix" style="color: var(--rpg-gold);">location_on</i>
                        <input id="location_name" name="location_name" type="text" class="validate" required
                               value="{% if location %}{{ location.location_name }}{% endif %}"
                               style="color: #e0e0e0;">
                        <label for="location_name" {% if location %}class="active"{% endif %}>Location Name *</label>
                    </div>

                    <!-- Parent Location (Optional) -->
                    {% if all_locations %}
                    <div class="input-field">
                        <i class="material-icons prefix" style="color: var(--rpg-gold);">account_tree</i>
                        <select id="parent_location_id" name="parent_location_id">
                            <option value="" {% if not parent_location_id %}selected{% endif %}>None (Top-level Location)</option>
                            {% for loc in all_locations %}
                            <option value="{{ loc.location_id }}" {% if parent_location_id == loc.location_id %}selected{% endif %}>
                                {{ loc.location_name }} ({{ loc.location_type }})
                            </option>
                            {% endfor %}
                        </select>
                        <label>Parent Location (Optional)</label>
                        <span class="helper-text">Select a parent location to create a hierarchical structure (e.g., City â†’ Building)</span>
                    </div>
                    {% endif %}

                    <!-- Location Type -->
                    <div class="input-field">
                        <i class="material-icons prefix" style="color: var(--rpg-gold);">category</i>
                        <select id="location_type" name="location_type" class="validate" required>
                            <option value="" disabled {% if not location %}selected{% endif %}>Choose Location Type</option>

                            {% if location_depth == 1 %}
                            <!-- PRIMARY LEVEL: Large geographic areas -->
                            <optgroup label="Primary Locations (Geographic Areas)">
                                <option value="Island" {% if location and location.location_type == "Island" %}selected{% endif %}>Island</option>
                                <option value="Forest" {% if location and location.location_type == "Forest" %}selected{% endif %}>Forest</option>
                                <option value="Country" {% if location and location.location_type == "Country" %}selected{% endif %}>Country</option>
                                <option value="District" {% if location and location.location_type == "District" %}selected{% endif %}>District</option>
                                <option value="Region" {% if location and location.location_type == "Region" %}selected{% endif %}>Region</option>
                                <option value="Province" {% if location and location.location_type == "Province" %}selected{% endif %}>Province</option>
                                <option value="Territory" {% if location and location.location_type == "Territory" %}selected{% endif %}>Territory</option>
                                <option value="Wilderness" {% if location and location.location_type == "Wilderness" %}selected{% endif %}>Wilderness</option>
                                <option value="Mountain Range" {% if location and location.location_type == "Mountain Range" %}selected{% endif %}>Mountain Range</option>
                                <option value="Valley" {% if location and location.location_type == "Valley" %}selected{% endif %}>Valley</option>
                                <option value="Peninsula" {% if location and location.location_type == "Peninsula" %}selected{% endif %}>Peninsula</option>
                                <option value="Archipelago" {% if location and location.location_type == "Archipelago" %}selected{% endif %}>Archipelago</option>
                            </optgroup>

                            {% elif location_depth == 2 %}
                            <!-- SECONDARY LEVEL: Settlements and communities -->
                            <optgroup label="Secondary Locations (Settlements)">
                                <option value="City" {% if location and location.location_type == "City" %}selected{% endif %}>City</option>
                                <option value="Town" {% if location and location.location_type == "Town" %}selected{% endif %}>Town</option>
                                <option value="Village" {% if location and location.location_type == "Village" %}selected{% endif %}>Village</option>
                                <option value="Settlement" {% if location and location.location_type == "Settlement" %}selected{% endif %}>Settlement</option>
                                <option value="Outpost" {% if location and location.location_type == "Outpost" %}selected{% endif %}>Outpost</option>
                                <option value="Fortress" {% if location and location.location_type == "Fortress" %}selected{% endif %}>Fortress</option>
                                <option value="Castle" {% if location and location.location_type == "Castle" %}selected{% endif %}>Castle</option>
                                <option value="Stronghold" {% if location and location.location_type == "Stronghold" %}selected{% endif %}>Stronghold</option>
                                <option value="Camp" {% if location and location.location_type == "Camp" %}selected{% endif %}>Camp</option>
                                <option value="Encampment" {% if location and location.location_type == "Encampment" %}selected{% endif %}>Encampment</option>
                            </optgroup>

                            {% elif location_depth == 3 %}
                            <!-- TERTIARY LEVEL: Buildings and specific structures -->
                            <optgroup label="Tertiary Locations (Buildings & Structures)">
                                <option value="House" {% if location and location.location_type == "House" %}selected{% endif %}>House</option>
                                <option value="Inn/Tavern" {% if location and location.location_type == "Inn/Tavern" %}selected{% endif %}>Inn/Tavern</option>
                                <option value="Bar" {% if location and location.location_type == "Bar" %}selected{% endif %}>Bar</option>
                                <option value="Shop" {% if location and location.location_type == "Shop" %}selected{% endif %}>Shop</option>
                                <option value="Store" {% if location and location.location_type == "Store" %}selected{% endif %}>Store</option>
                                <option value="Market" {% if location and location.location_type == "Market" %}selected{% endif %}>Market</option>
                                <option value="Park" {% if location and location.location_type == "Park" %}selected{% endif %}>Park</option>
                                <option value="Building" {% if location and location.location_type == "Building" %}selected{% endif %}>Building</option>
                                <option value="Stable" {% if location and location.location_type == "Stable" %}selected{% endif %}>Stable</option>
                                <option value="Dwelling" {% if location and location.location_type == "Dwelling" %}selected{% endif %}>Dwelling</option>
                                <option value="Courthouse" {% if location and location.location_type == "Courthouse" %}selected{% endif %}>Courthouse</option>
                                <option value="Temple" {% if location and location.location_type == "Temple" %}selected{% endif %}>Temple</option>
                                <option value="Church" {% if location and location.location_type == "Church" %}selected{% endif %}>Church</option>
                                <option value="Guild Hall" {% if location and location.location_type == "Guild Hall" %}selected{% endif %}>Guild Hall</option>
                                <option value="Academy" {% if location and location.location_type == "Academy" %}selected{% endif %}>Academy</option>
                                <option value="Library" {% if location and location.location_type == "Library" %}selected{% endif %}>Library</option>
                                <option value="Warehouse" {% if location and location.location_type == "Warehouse" %}selected{% endif %}>Warehouse</option>
                                <option value="Barracks" {% if location and location.location_type == "Barracks" %}selected{% endif %}>Barracks</option>
                                <option value="Tower" {% if location and location.location_type == "Tower" %}selected{% endif %}>Tower</option>
                                <option value="Plaza" {% if location and location.location_type == "Plaza" %}selected{% endif %}>Plaza</option>
                                <option value="Courtyard" {% if location and location.location_type == "Courtyard" %}selected{% endif %}>Courtyard</option>
                                <option value="Ship" {% if location and location.location_type == "Ship" %}selected{% endif %}>Ship</option>
                                <option value="Spaceship" {% if location and location.location_type == "Spaceship" %}selected{% endif %}>Spaceship</option>
                                <option value="Airship" {% if location and location.location_type == "Airship" %}selected{% endif %}>Airship</option>
                                <option value="Port" {% if location and location.location_type == "Port" %}selected{% endif %}>Port</option>
                                <option value="Dock" {% if location and location.location_type == "Dock" %}selected{% endif %}>Dock</option>
                                <option value="Arena" {% if location and location.location_type == "Arena" %}selected{% endif %}>Arena</option>
                                <option value="Colosseum" {% if location and location.location_type == "Colosseum" %}selected{% endif %}>Colosseum</option>
                            </optgroup>
                            {% endif %}
                        </select>
                        <label>Location Type * (Level {{ location_depth }})</label>
                        <span class="helper-text">
                            {% if location_depth == 1 %}Level 1: Large geographic areas{% elif location_depth == 2 %}Level 2: Settlements and communities{% else %}Level 3: Specific buildings and structures{% endif %}
                        </span>
                    </div>

                    <!-- Features (Multi-select) -->
                    <div class="input-field">
                        <i class="material-icons prefix" style="color: var(--rpg-gold);">stars</i>
                        <select id="features" name="features" multiple>
                            <option value="" disabled>Choose Features</option>
                            <option value="Trading Post" {% if location and "Trading Post" in location.features %}selected{% endif %}>Trading Post</option>
                            <option value="Blacksmith" {% if location and "Blacksmith" in location.features %}selected{% endif %}>Blacksmith</option>
                            <option value="Magic Shop" {% if location and "Magic Shop" in location.features %}selected{% endif %}>Magic Shop</option>
                            <option value="Quest Board" {% if location and "Quest Board" in location.features %}selected{% endif %}>Quest Board</option>
                            <option value="Safe Haven" {% if location and "Safe Haven" in location.features %}selected{% endif %}>Safe Haven</option>
                            <option value="Dangerous" {% if location and "Dangerous" in location.features %}selected{% endif %}>Dangerous</option>
                            <option value="Hidden" {% if location and "Hidden" in location.features %}selected{% endif %}>Hidden</option>
                            <option value="Magical" {% if location and "Magical" in location.features %}selected{% endif %}>Magical</option>
                            <option value="Ancient" {% if location and "Ancient" in location.features %}selected{% endif %}>Ancient</option>
                            <option value="Cursed" {% if location and "Cursed" in location.features %}selected{% endif %}>Cursed</option>
                            <option value="Sacred" {% if location and "Sacred" in location.features %}selected{% endif %}>Sacred</option>
                            <option value="Abandoned" {% if location and "Abandoned" in location.features %}selected{% endif %}>Abandoned</option>
                            <option value="Thriving" {% if location and "Thriving" in location.features %}selected{% endif %}>Thriving</option>
                            <option value="Under Siege" {% if location and "Under Siege" in location.features %}selected{% endif %}>Under Siege</option>
                            <option value="Mysterious" {% if location and "Mysterious" in location.features %}selected{% endif %}>Mysterious</option>
                            <option value="Fortified" {% if location and "Fortified" in location.features %}selected{% endif %}>Fortified</option>
                            <option value="Underground" {% if location and "Underground" in location.features %}selected{% endif %}>Underground</option>
                            <option value="Floating" {% if location and "Floating" in location.features %}selected{% endif %}>Floating</option>
                        </select>
                        <label>Features</label>
                    </div>

                    <!-- Description -->
                    <div class="input-field">
                        <i class="material-icons prefix" style="color: var(--rpg-gold);">description</i>
                        <textarea id="description" name="description" class="materialize-textarea"
                                  style="color: #e0e0e0;">{% if location %}{{ location.description }}{% endif %}</textarea>
                        <label for="description" {% if location and location.description %}class="active"{% endif %}>Description</label>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="row" style="margin-top: 30px;">
                        <div class="col s12">
                            <button type="submit" class="btn-large waves-effect waves-light" style="background: linear-gradient(135deg, var(--rpg-gold) 0%, #d4af37 100%);">
                                <i class="material-icons left">save</i>{% if location %}Update Location{% else %}Create Location{% endif %}
                            </button>
                            {% if location %}
                            <a href="{% url 'location_detail' world.world_id region.region_id location.location_id %}" class="btn-large waves-effect waves-light grey darken-2" style="margin-left: 10px;">
                                <i class="material-icons left">cancel</i>Cancel
                            </a>
                            {% else %}
                            <a href="{% url 'region_detail' world.world_id region.region_id %}" class="btn-large waves-effect waves-light grey darken-2" style="margin-left: 10px;">
                                <i class="material-icons left">cancel</i>Cancel
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize select dropdowns
        var elems = document.querySelectorAll('select');
        M.FormSelect.init(elems);

        // Initialize textarea auto-resize
        var textareas = document.querySelectorAll('textarea');
        M.textareaAutoResize(textareas);
    });
</script>
{% endblock %}
